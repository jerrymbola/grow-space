<!DOCTYPE html>
<html lang="en" x-data="chatApp()" :class="{ 'dark': dark }">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talk To Someone | b.you!</title>
    <meta name="theme-color" content="#f8fafc" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        glass: 'rgba(255, 255, 255, 0.25)',
                        darkglass: 'rgba(15, 23, 42, 0.5)',
                        darkbg: '#0f172a',
                        lightbg: '#f8fafc',
                        primary: {
                            light: '#e0f2fe',
                            dark: '#0369a1'
                        },
                        secondary: {
                            light: '#f0fdf4',
                            dark: '#166534'
                        },
                        chat: {
                            user: '#e0f2fe',
                            bot: '#f0fdf4',
                            darkuser: '#0369a1',
                            darkbot: '#166534'
                        }
                    },
                    backdropBlur: {
                        xs: '4px',
                        sm: '8px',
                    },
                    boxShadow: {
                        glass: '0 4px 30px rgba(0, 0, 0, 0.1)',
                        glow: '0 0 10px rgba(59, 130, 246, 0.3)'
                    },
                },
            },
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f8fafc;
            min-height: 100vh;
            margin: 0;
        }

        .dark body {
            background-color: #0f172a;
        }

        /* Header */
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: rgba(248, 250, 252, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .dark .sticky-header {
            background: rgba(15, 23, 42, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .content-wrapper {
            padding-top: 80px;
            height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
        }

        /* Chat Container */
        .chat-layout {
            display: grid;
            grid-template-columns: 1fr;
            height: 100%;
        }

        @media (min-width: 1024px) {
            .chat-layout {
                grid-template-columns: 300px 1fr;
                gap: 1.5rem;
            }
        }

        /* Chat Selection */
        .chat-selection {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }

        .dark .chat-selection {
            border-right-color: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 1023px) {
            .chat-selection {
                display: none;
            }
        }

        /* Chat Area */
        .chat-area {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 1rem;
        }

        /* Message Bubbles */
        .message-bubble {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            margin-bottom: 0.75rem;
            position: relative;
            word-wrap: break-word;
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        @media (min-width: 640px) {
            .message-bubble {
                font-size: 1rem;
                line-height: 1.5rem;
            }
        }

        .user-message {
            background-color: #e0f2fe;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }

        .dark .user-message {
            background-color: #0369a1;
            color: white;
        }

        .bot-message {
            background-color: #f0fdf4;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }

        .dark .bot-message {
            background-color: #166534;
            color: white;
        }

        /* Input Area - Always visible */
        .input-container {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            position: sticky;
            bottom: 0;
        }

        .dark .input-container {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Chat Options */
        .chat-option {
            transition: all 0.2s ease;
            font-size: 0.8125rem;
            line-height: 1.125rem;
        }

        @media (min-width: 640px) {
            .chat-option {
                font-size: 0.875rem;
                line-height: 1.25rem;
            }
        }

        /* Chat Type Selector */
        .chat-type-selector {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }

        .dark .chat-type-selector {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .chat-type-tab {
            flex: 1;
            text-align: center;
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .chat-type-tab.active {
            border-bottom-color: #ec4899;
            font-weight: 500;
        }

        /* Typing Indicator */
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #9ca3af;
            margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-6px);
            }
        }

        /* Mobile adjustments */
        @media (max-width: 640px) {
            .content-wrapper {
                padding-top: 70px;
                height: calc(100vh - 70px);
            }

            .message-bubble {
                max-width: 90%;
                padding: 0.625rem 0.875rem;
            }
        }
    </style>
</head>

<body class="font-sans transition-colors duration-300 text-gray-800 dark:text-gray-100">
    <div class="page-container">
        <!-- Sticky Navbar -->
        <header class="sticky-header py-4 w-full">
            <div class="flex items-center justify-between px-6 lg:px-[3.5rem] max-w-7xl mx-auto">
                <div class="flex items-center gap-4">
                    <a href="../index.html"
                        class="flex items-center gap-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        <span class="text-2xl font-bold tracking-wide text-gray-900 dark:text-gray-100">b.you!</span>
                    </a>
                </div>
                <button @click="dark = !dark" aria-label="Toggle dark mode" aria-pressed="false"
                    x-bind:aria-pressed="dark"
                    class="theme-toggle glass-card hover:bg-white/30 dark:hover:bg-black/30 w-12 h-12 rounded-full flex items-center justify-center focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="sun h-6 w-6 text-yellow-300" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 3v1m0 16v1m8.66-8.66h-1M4.34 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="moon h-6 w-6 text-blue-800" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M17.293 14.707A8 8 0 0112 4a8 8 0 000 16 8 8 0 005.293-1.707z" />
                    </svg>
                </button>
            </div>
        </header>

        <div class="content-wrapper">
            <div class="chat-layout">
                <!-- Chat Selection Sidebar (Desktop) -->
                <div class="chat-selection" x-show="isDesktop">
                    <h2 class="text-lg font-semibold mb-4">Choose who to talk with</h2>

                    <div class="space-y-4">
                        <!-- AI Chat Option -->
                        <button @click="selectChatType('ai')" class="w-full p-4 rounded-lg text-left transition-colors"
                            :class="{
                                'bg-blue-100 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800': chatType === 'ai',
                                'glass-card hover:shadow-glow': chatType !== 'ai'
                            }">
                            <div class="flex items-center gap-3">
                                <svg aria-hidden="true" class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor"
                                    stroke-width="1.5" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                                </svg>
                                <div>
                                    <h3 class="font-medium">AI Companion</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Always available to chat</p>
                                </div>
                            </div>
                        </button>

                        <!-- Community Chat Option -->
                        <button @click="selectChatType('community')"
                            class="w-full p-4 rounded-lg text-left transition-colors" :class="{
                                'bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-800': chatType === 'community',
                                'glass-card hover:shadow-glow': chatType !== 'community'
                            }">
                            <div class="flex items-center gap-3">
                                <svg aria-hidden="true" class="w-6 h-6 text-green-500" fill="none" stroke="currentColor"
                                    stroke-width="1.5" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
                                </svg>
                                <div>
                                    <h3 class="font-medium">Community Chat</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Connect with real people</p>
                                </div>
                            </div>
                        </button>
                    </div>

                    <!-- Community Info -->
                    <div x-show="chatType === 'community'"
                        class="mt-6 p-4 rounded-lg bg-green-50/50 dark:bg-green-900/10 border border-green-100 dark:border-green-900/20">
                        <h3 class="font-medium mb-2">About Community Chat</h3>
                        <p class="text-sm">Connect with other members of our supportive community. Our online members
                            are here to listen and share.</p>
                    </div>

                    <!-- AI Info -->
                    <div x-show="chatType === 'ai'"
                        class="mt-6 p-4 rounded-lg bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/20">
                        <h3 class="font-medium mb-2">About AI Companion</h3>
                        <p class="text-sm">Our AI companion is always available to chat, offering a judgment-free space
                            to share your thoughts.</p>
                    </div>
                </div>

                <!-- Main Chat Area -->
                <div class="chat-area">
                    <!-- Chat Type Selector (Mobile) -->
                    <div class="chat-type-selector" x-show="!isDesktop">
                        <div @click="selectChatType('ai')" class="chat-type-tab"
                            :class="{ 'active': chatType === 'ai' }">
                            AI Companion
                        </div>
                        <div @click="selectChatType('community')" class="chat-type-tab"
                            :class="{ 'active': chatType === 'community' }">
                            Community
                        </div>
                    </div>

                    <!-- Chat Header -->
                    <div class="flex items-center gap-4 px-6 pt-6">
                        <svg aria-hidden="true" class="w-8 h-8 text-pink-500" fill="none" stroke="currentColor"
                            stroke-width="1.5" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155" />
                        </svg>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100"
                            x-text="chatType === 'ai' ? 'AI Companion' : 'Community Chat'"></h1>
                    </div>

                    <!-- Introduction -->
                    <div class="mb-6 p-4 mx-6 rounded-xl"
                        :class="chatType === 'ai' ? 'bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/20' : 'bg-green-50/50 dark:bg-green-900/10 border border-green-100 dark:border-green-900/20'">
                        <p x-show="chatType === 'ai'" class="text-blue-800 dark:text-blue-200">Need someone to talk to?
                            I'm here to listen and chat with you about anything on your mind.</p>
                        <p x-show="chatType === 'community'" class="text-green-800 dark:text-green-200">Connect with
                            supportive community members. Please be kind and respectful in your conversations.</p>
                    </div>

                    <!-- Messages Area -->
                    <div class="messages-container space-y-3" id="messages">
                        <!-- Welcome Message -->
                        <div class="message-bubble bot-message" x-show="chatType === 'ai'">
                            <p>Hi there! ðŸ‘‹ I'm your AI companion, always available to chat. You can talk to me about
                                anything that's on your mind - your day, your thoughts, or anything you'd like to share.
                                What would you like to talk about?</p>
                        </div>

                        <div class="message-bubble bot-message" x-show="chatType === 'community'">
                            <p>Welcome to our community chat! ðŸ‘‹ You'll be connected with another community member
                                shortly. While you wait, feel free to share what's on your mind.</p>
                        </div>

                        <!-- Quick Options -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4 px-4">
                            <template x-if="chatType === 'ai'">
                                <button @click="sendQuickMessage('I just want to chat')"
                                    class="chat-option glass-card p-3 rounded-lg text-left hover:shadow-glow focus:outline-none">
                                    <p>I just want to chat</p>
                                </button>
                            </template>
                            <template x-if="chatType === 'ai'">
                                <button @click="sendQuickMessage('I need advice about something')"
                                    class="chat-option glass-card p-3 rounded-lg text-left hover:shadow-glow focus:outline-none">
                                    <p>I need advice about something</p>
                                </button>
                            </template>
                            <template x-if="chatType === 'community'">
                                <button @click="sendQuickMessage('Looking for someone to talk to')"
                                    class="chat-option glass-card p-3 rounded-lg text-left hover:shadow-glow focus:outline-none">
                                    <p>Looking for someone to talk to</p>
                                </button>
                            </template>
                            <template x-if="chatType === 'community'">
                                <button @click="sendQuickMessage('I need support with something')"
                                    class="chat-option glass-card p-3 rounded-lg text-left hover:shadow-glow focus:outline-none">
                                    <p>I need support with something</p>
                                </button>
                            </template>
                        </div>
                    </div>

                    <!-- Input Area - Always visible -->
                    <div class="input-container">
                        <form @submit.prevent="sendMessage()" class="flex gap-2">
                            <input x-model="message" type="text" placeholder="Type your message here..."
                                class="flex-1 bg-white/50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                @keydown.enter="sendMessage()">
                            <button type="submit"
                                class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2">
                                Send
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('chatApp', () => ({
                dark: localStorage.getItem('dark') === 'true',
                message: '',
                messages: [],
                loading: false,
                chatType: 'ai', // 'ai' or 'community'
                isDesktop: window.innerWidth >= 1024,
                apiKey: '', // You'll need to set this or get it from user input

                init() {
                    // Initialize dark mode from localStorage
                    this.$watch('dark', value => {
                        localStorage.setItem('dark', value);
                        if (value) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                    });

                    // Check screen size
                    window.addEventListener('resize', () => {
                        this.isDesktop = window.innerWidth >= 1024;
                    });

                    // Initialize chat based on type
                    this.initializeChat();

                    // Scroll to bottom of messages
                    this.$nextTick(() => {
                        this.scrollToBottom();
                    });
                },

                selectChatType(type) {
                    this.chatType = type;
                    this.initializeChat();
                },

                initializeChat() {
                    this.messages = [];
                    if (this.chatType === 'ai') {
                        this.messages.push({
                            text: "Hi there! ðŸ‘‹ I'm your AI companion, always available to chat. You can talk to me about anything that's on your mind - your day, your thoughts, or anything you'd like to share. What would you like to talk about?",
                            sender: 'bot'
                        });
                    } else {
                        this.messages.push({
                            text: "Welcome to our community chat! ðŸ‘‹ You'll be connected with another community member shortly. While you wait, feel free to share what's on your mind.",
                            sender: 'bot'
                        });
                    }
                },

                sendQuickMessage(text) {
                    this.message = text;
                    this.sendMessage();
                },

                async sendMessage() {
                    if (!this.message.trim()) return;

                    const userMessage = this.message;
                    this.messages.push({ text: userMessage, sender: 'user' });
                    this.message = '';

                    this.$nextTick(() => {
                        this.scrollToBottom();
                        this.showTypingIndicator();
                    });

                    try {
                        if (this.chatType === 'ai') {
                            // Call Gemini API for AI chat
                            const response = await this.callGeminiAPI(userMessage);
                            this.addBotMessage(response);
                        } else {
                            // Simulate community response
                            setTimeout(() => {
                                this.addBotMessage("Thanks for your message! A community member will respond shortly.");
                            }, 2000);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.addBotMessage("I'm having trouble connecting right now. Please try again later.");
                    }
                },

                async callGeminiAPI(prompt) {
                    // In a real implementation, you would call the Gemini API here
                    // This is a mock implementation that simulates API responses

                    // Simulate API delay
                    await new Promise(resolve => setTimeout(resolve, 1000));

                    // Simple response logic based on user input
                    const lowerMessage = prompt.toLowerCase();

                    if (lowerMessage.includes('advice')) {
                        return "I'm happy to offer advice. Could you tell me more about the situation you're seeking advice on? The more context you provide, the better I can help.";
                    }
                    else if (lowerMessage.includes('uplifting') || lowerMessage.includes('encouragement')) {
                        const upliftingMessages = [
                            "Remember that every day is a fresh start. You've overcome 100% of your bad days so far!",
                            "You are capable of more than you know. Trust in your ability to grow and adapt.",
                            "Progress isn't always linear. Celebrate the small wins along your journey."
                        ];
                        return upliftingMessages[Math.floor(Math.random() * upliftingMessages.length)];
                    }
                    else if (lowerMessage.includes('decision')) {
                        return "When facing a decision, it can help to list the pros and cons of each option. Would you like to talk through the options you're considering?";
                    }
                    else {
                        const responses = [
                            "I hear you. Would you like to tell me more about that?",
                            "Thanks for sharing. What else is on your mind?",
                            "I'm here to listen. How has your day been so far?",
                            "That's interesting. Can you elaborate on that?"
                        ];
                        return responses[Math.floor(Math.random() * responses.length)];
                    }
                },

                addBotMessage(text) {
                    // Remove typing indicator
                    const typingIndicator = document.querySelector('.typing-indicator');
                    if (typingIndicator) {
                        typingIndicator.remove();
                    }

                    this.messages.push({ text, sender: 'bot' });
                    this.$nextTick(() => {
                        this.scrollToBottom();
                    });
                },

                showTypingIndicator() {
                    const typingElement = document.createElement('div');
                    typingElement.className = 'message-bubble bot-message typing-indicator';
                    typingElement.innerHTML = '<span></span><span></span><span></span>';

                    const messagesContainer = document.getElementById('messages');
                    messagesContainer.appendChild(typingElement);
                    this.scrollToBottom();
                },

                scrollToBottom() {
                    const messagesContainer = document.getElementById('messages');
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }));
        });
    </script>
</body>

</html>